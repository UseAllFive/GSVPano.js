var GSVPANO=GSVPANO||{};
GSVPANO.PanoLoader=function(i){var i=i||{},d,l,p=new google.maps.StreetViewService,h=0,j=0,a=document.createElement("canvas"),k=a.getContext("2d"),m=0,n=0;this.setProgress=function(c){if(this.onProgress)this.onProgress(c)};this.throwError=function(c){if(this.onError)this.onError(c);else console.error(c)};this.adaptTextureToZoom=function(){var c=416*Math.pow(2,d),f=416*Math.pow(2,d-1);a.width=c;a.height=f;k.translate(a.width,0);k.scale(-1,1)};this.composeFromTile=function(c,f,b){k.drawImage(b,512*
c,512*f);h++;this.setProgress(Math.round(100*h/j));if(h===j&&(this.canvas=a,this.onPanoramaLoad))this.onPanoramaLoad()};this.composePanorama=function(c){this.setProgress(0);var f=3==d?7:Math.pow(2,d),b=Math.pow(2,d-1),e=this,o,a,g;h=0;j=f*b;for(g=0;g<b;g++)for(a=0;a<f;a++)o="http://maps.google.com/cbk?output=tile&panoid="+c+"&zoom="+d+"&x="+a+"&y="+g+"&"+Date.now(),function(b,c){var a=new Image;a.addEventListener("load",function(){e.composeFromTile(b,c,this)});a.crossOrigin="";a.src=o}(a,g)};this.load=
function(c,a){var b=this;p.getPanoramaByLocation(c,50,function(e,d){if(d===google.maps.StreetViewStatus.OK){if(b.onPanoramaData)b.onPanoramaData(e);m=e.tiles.centerHeading*Math.PI/180;n=e.tiles.originPitch;b.copyright=e.copyright;l=e.location.pano;b.location=c;b.rotation=m;b.pitch=n;b.image_date=e.imageDate;b.id=l}else{if(b.onNoPanoramaData)b.onNoPanoramaData(d);b.throwError("Could not retrieve panorama for the following reason: "+d)}a()})};this.setZoom=function(a){d=a;this.adaptTextureToZoom()};
this.setZoom(i.zoom||1)};
